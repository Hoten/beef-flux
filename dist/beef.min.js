var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},Beef=function(){function t(){}return t.service=function(t,e){return void 0===e&&(e=null),null!==e&&(this.services[t]=e),this.services[t]},t.setup=function(t){this.setupCallbacks.push(t)},t.start=function(){this.started||(this.setupCallbacks.forEach(function(t){t()}),this.started=!0)},t.started=!1,t.Actions=function(){return t.start(),{create:function(t){return Actions.create(t)}}},t.Api=function(){return t.start(),t.service(ApiService.SERVICE_ID)},t.Dispatcher=function(){return t.start(),t.service(Dispatcher.SERVICE_ID)},t.Store=function(){return t.start(),{create:function(t){var e=$.extend(!0,new Store,t);return e.actions(),e}}},t.Router=function(){return t.start(),t.service(RoutingService.SERVICE_ID)},t.services={},t.setupCallbacks=[],t}(),BaseApp=function(){function t(){}return t.prototype.setup=function(){},t.prototype.run=function(){},t}(),BaseService=function(){function t(){}return t}(),Store=function(){function t(){this.rows={},this.actions=function(){},this.dispatchIndex=null}return t.prototype.listen=function(t,e){$(window).on(t,e)},t.prototype.ignore=function(t,e){$(window).off(t,e)},t.prototype.emit=function(t,e){void 0===e&&(e=!1),$(window).trigger(t,[e])},t.prototype.upsertRow=function(t,e,n,i,r){void 0===r&&(r=!1);var o=!1;"undefined"==typeof this.rows[t]&&(this.rows[t]=[]);var a=this.rows[t],u=this;a.forEach(function(t,s){"undefined"!=typeof t[e]&&t[e]===n&&("undefined"==typeof a[s]&&(a[s]={}),a[s]=r?a[s]=i:u.merge(a[s],i),o=!0)}),o||this.rows[t].push(i)},t.prototype.removeRow=function(t,e,n){if("undefined"!=typeof this.rows[t]){var i=this.rows[t],r=[];if(i.forEach(function(t,i){"undefined"!=typeof t[e]&&t[e]==n&&r.push(i)}),0!==r.length)for(var o=0;o<r.length;o++)this.rows[t].splice(r[o],1)}},t.prototype.removeRows=function(t,e,n){var i=this;n.forEach(function(n){i.removeRow(t,e,n)})},t.prototype.clearAll=function(t){this.rows[t]=[]},t.prototype.getRows=function(t,e){return void 0===e&&(e=!0),"undefined"!=typeof this.rows[t]?e?this.rows[t]:this.rows[t].slice(0):[]},t.prototype.sanitizeAndValidate=function(t,e){var n=this.sanitize(t,e,!1),i=this.validate(n,e);return i===!0?n:i},t.prototype.validate=function(t,e){var n=[];for(var i in e)if("undefined"!=typeof e[i].validation)for(var r in e[i].validation){if(n.length>0)break;var o=t[i],a=e[i].label?e[i].label:i;switch(r){case"required":"undefined"!=typeof o&&null!==o&&""!==o||n.push(a+" is required");break;case"minLength":o.length<e[i].validation[r]&&n.push(a+" must be at least "+e[i].validation[r]+" characters");break;case"maxLength":o.length>e[i].validation[r]&&n.push(a+" must be at under "+e[i].validation[r]+" characters");break;default:if("function"==typeof e[i].validation[r]){var u=e[i].validation[r](o);u!==!0&&n.concat(u)}}}return!(n.length>0)||n},t.prototype.sanitize=function(t,e,n){void 0===n&&(n=!1);var i={},r=jQuery.extend(!0,{},t);for(var o in e)i[o]=this.sanitizeField(o,r,e,n);return i},t.prototype.merge=function(t,e,n){void 0===n&&(n=1);var i=this;if(3===n)return e;for(var r in e)try{e[r].constructor===Object?t[r]=i.merge(t[r],e[r],n+1):t[r]=e[r]}catch(n){t[r]=e[r]}return t},t.prototype.sortBy=function(t,e){return void 0===e&&(e="desc"),function(n,i){return i[t]&&!n[t]||i[t]&&n[t]&&i[t]>n[t]?"desc"===e.toLowerCase()?1:-1:!i[t]&&n[t]||i[t]&&n[t]&&i[t]<n[t]?"desc"===e.toLowerCase()?-1:1:i[t]&&n[t]&&i[t]==n[t]?0:i[t]&&!n[t]?0:void 0}},t.prototype.money=function(t){return t.toFixed(2)},t.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)})},t.string=function(t){return void 0===t&&(t={}),$.extend(!0,{type:"string"},t)},t.int=function(t){return void 0===t&&(t={}),$.extend(!0,{type:"int"},t)},t.double=function(t){return void 0===t&&(t={}),$.extend(!0,{type:"double"},t)},t.bool=function(t){return void 0===t&&(t={}),$.extend(!0,{type:"bool"},t)},t.float=function(t){return void 0===t&&(t={}),$.extend(!0,{type:"float"},t)},t.array=function(t){return void 0===t&&(t={}),$.extend(!0,{type:"array",schema:null},t)},t.object=function(t){return void 0===t&&(t={}),$.extend(!0,{type:"object",schema:null},t)},t.datetime=function(t){return void 0===t&&(t={}),$.extend(!0,{type:"datetime",schema:null,format:"YYYY-MM-DD HH:mm:ss"},t)},t.callback=function(t){return void 0===t&&(t={}),$.extend(!0,{type:"callback",schema:null},t)},t.prototype.sanitizeField=function(t,e,n,i){if("function"===n[t].type)return n[t].value;"undefined"==typeof e[t]&&("undefined"!=typeof n[t].initial?e[t]=n[t].initial():e[t]=null);var r=n[t].type;if(null===e[t]&&"obj"!==r&&"object"!==r)return null;switch(n[t].field=t,r){case"int":case"integer":return this.sanitizeInteger(e[t],n[t]);case"float":case"double":return this.sanitizeFloat(e[t],n[t]);case"string":case"char":case"varchar":return this.sanitizeString(e[t],n[t]);case"date":case"datetime":case"timestamp":return this.sanitizeDateTime(e[t],n[t],i);case"bool":case"boolean":return this.sanitizeBoolean(e[t],n[t]);case"obj":case"object":return this.sanitizeObject(e[t],n[t],i);case"array":case"collection":return this.sanitizeArray(e[t],n[t],i);default:if("undefined"!==n[t].sanitize)return n[t].sanitize(e[t],n[t])}},t.prototype.sanitizeInteger=function(t,e){if("string"==typeof t&&(t=t.replace(/[a-zA-Z]+/gi,""),0===t.length))return t="";if(t=parseInt(t),"undefined"!=typeof e.min&&t<e.min)throw new Error("Provided value cannot be sanitized, value is below minimum integer allowed");if("undefined"!=typeof e.max&&t>e.max)throw new Error("Provided value cannot be sanitized, value is greater than maximum integer allowed");return isNaN(t)?t="":t},t.prototype.sanitizeFloat=function(t,e){if(t=parseFloat(t),"undefined"!=typeof e.min&&t<e.min)throw new Error("Provided value cannot be sanitized, value is below minimum float allowed");if("undefined"!=typeof e.max&&t>e.max)throw new Error("Provided value cannot be sanitized, value is greater than maximum float allowed");return t},t.prototype.sanitizeString=function(t,e){if(t=String(t),"undefined"!=typeof e.minLength&&t.length<e.minLength)throw new Error("Provided value cannot be sanitized, string length is below minimum allowed");return"undefined"!=typeof e.maxLength&&t.length>e.maxLength&&(console.warn("Value was truncated during sanitation"),t=t.substr(0,e.maxLength)),t},t.prototype.sanitizeDateTime=function(t,e,n){if(moment(t,e.format).isValid())return n?moment(t).utc().format("YYYY-MM-DD hh:mm:ss"):"undefined"==typeof e.utc||e.utc?moment.utc(t):moment(t);throw new Error("Provided value ("+t+") cannot be sanitized for field ("+e.field+"), is not a valid date")},t.prototype.sanitizeBoolean=function(t,e){if(t===!1||t===!0)return t;if("string"==typeof t){if("false"===t.toLowerCase().trim())return!1;if("true"===t.toLowerCase().trim())return!0}if(0===parseInt(t))return!1;if(1===parseInt(t))return!0;throw new Error("Provided value cannot be santized, is not a valid boolean")},t.prototype.sanitizeObject=function(t,e,n){if("undefined"==typeof e.schema)throw new Error("Provided value cannot be santized, no reference schema provided for field type of object");return null===e.schema?t:null===t?null:this.sanitize(t,e.schema(),n)},t.prototype.sanitizeArray=function(t,e,n){if("undefined"==typeof e.schema||null===e.schema||e.schema===!1)return t;if("undefined"==typeof t.length)return[];var i=this;return t.map(function(t){return i.sanitize(t,e.schema(),n)})},t.prototype.getDispatcher=function(){return Beef.service(Dispatcher.SERVICE_ID)},t}(),Action=function(){function t(){this._callbacks={}}return t.prototype._register=function(t,e){for(var n in t){var i=t[n].name?t[n].name:t[n].toString().match(/^function\s*([^\s(]+)/)[1];"undefined"==typeof this._callbacks[i]&&(this._callbacks[i]=[]),this._callbacks[i].push(e[n].bind(e))}},t.prototype._dispatch=function(t,e,n){if("undefined"!=typeof this._callbacks[t]){var i=e.apply(this,n);this._callbacks[t].forEach(function(t){t(i)})}},t}(),Actions=function(){function t(){}return t.create=function(e){var n=new Action;for(var i in e)"_"===i[0]||t.ignoreFunctions.indexOf(i)>=0||(n[i]=new function(){return new Function("return function (fn) { return function "+i+" () { return fn(this, arguments) }; };")()(Function.apply.bind(function(t){var i=[];for(var r in arguments)"0"!==r&&i.push(arguments[r]);n._dispatch(t,e[t].bind(n),i)}.bind(null,i)))});return n},t.ignoreFunctions=["constructor"],t}(),DispatcherCallback=function(){function t(t,e,n){void 0===e&&(e=[]),this.func=t,this.dependencies=e,this.dispatchId=n}return t}(),DispatcherPayload=function(){function t(t,e){this.action=t,this.data=e}return t}(),RoutingConfig=function(){function t(t){this.routes=t}return t.prototype.isRoute=function(t){return"undefined"!=typeof this.routes[t]},t.prototype.callRoute=function(t,e){return this.routes[t](e)},t}(),ApiService=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.throttle=function(t,e,n){var i;return function(){var r=this,o=arguments,a=function(){i=null,n||t.apply(r,o)},u=n&&!i;clearTimeout(i),i=setTimeout(a,e),u&&t.apply(r,o)}},e.prototype.get=function(t,e){return this.doAjaxCall("GET",{url:this.buildUrl(t,e),dataType:"json"})},e.prototype.post=function(t,e){return this.doAjaxCall("POST",{url:this.buildUrl(t,e,!1),data:JSON.stringify(e),dataType:"json"})},e.prototype.put=function(t,e){return this.doAjaxCall("PUT",{url:this.buildUrl(t,e,!1),data:JSON.stringify(e),dataType:"json"})},e.prototype.delete=function(t,e){return this.doAjaxCall("DELETE",{url:this.buildUrl(t,e),dataType:"json"})},e.prototype.buildUrl=function(t,e,n){void 0===n&&(n=!0);for(var i in e)t.indexOf("{"+i+"}")===-1?n!==!1&&(t+=t.indexOf("?")!==-1?"&":"?",t+=i+"="+e[i]):t=t.replace("{"+i+"}",e[i]);return t},e.prototype.doAjaxCall=function(t,e){var n=$.fn.jquery.split("."),i=n[0],r=n[1];return 1==i&&r<9?(e.type=t,$.ajax(e)):(e.method=t,$.ajax(e))},e.SERVICE_ID="beef.service.api",e}(BaseService),Dispatcher=function(t){function e(){t.apply(this,arguments),this.maxIterations=10,this.callbacks=[]}return __extends(e,t),e.prototype.register=function(t,e){var n=this.callbacks.length;return this.callbacks.push(new DispatcherCallback(t,e,n)),n},e.prototype.dispatch=function(t,e){for(var n=new DispatcherPayload(t,e),i=[],r=0,o=0;r<this.maxIterations&&i.length<this.callbacks.length;){o>=this.callbacks.length&&(o=0,r++);var a=this.callbacks[o];i.filter(function(t){return a.dependencies.indexOf(t)!==-1}).length===a.dependencies.length&&(a.func(n),i.push(a.dispatchId),o++)}r>=this.maxIterations&&console.warn("Hit max dispatcher iterations, check dependencies of callbacks")},e.SERVICE_ID="beef.service.dispatcher",e}(BaseService),RoutingService=function(){function t(){}return t.prototype.onRouteFinished=function(){},t.prototype.routes=function(t){return this.routingConfig=new RoutingConfig(t),this},t.prototype.route=function(t,e){var n=this.routingConfig.isRoute(t);if(n||(t="/"),this.routingConfig.isRoute(t)){var i=this.routingConfig.callRoute(t,e);return this.activeRoute=t,this.onRouteFinished(),i}return null},t.prototype.doRouting=function(t){void 0===t&&(t=null);var e="";for(var n in this.routingConfig.routes){e=n,t=null!==t?t:window.location.hash,t.indexOf("?")>=0&&(t=t.substring(0,t.indexOf("?")));var i=n.match(/\{[a-z\_\-\+]+\}/gi),r={};if(null!==i){var o=n.split("/"),a=t.split("/");if(a=a.splice(1,a.length-1),a.length!==o.length)continue;var u=0,s=!1;if(a.forEach(function(t){o[u].match(/\{[a-z\_\-\+]+\}/gi)||t!==o[u]&&(s=!0),u++}),s)continue;e="",o.forEach(function(t,n){n>0&&(e+="/"),e+=a[n],n>0&&(r[t.replace(/[\{\}]/gi,"")]=a[n])})}e=e.replace("+","\\+");var c=new RegExp("^#/"+e+"$","gi");if(null!==t.match(c))return this.activeRoute===n&&r===this.routeData?this.lastResponse:(this.routeData=r,this.activeRoute=n,this.lastResponse=this.route(n,r))}return this.lastResponse=this.route("/",{})},t.SERVICE_ID="beef.service.routing",t}();Beef.setup(function(){Beef.service(ApiService.SERVICE_ID,new ApiService),Beef.service(Dispatcher.SERVICE_ID,new Dispatcher),Beef.service(RoutingService.SERVICE_ID,new RoutingService)});